<html>

<head>

</head>

<body>
    <canvas id="canvas"></canvas>
</body>
<script src="star.js"></script>
<script src="planet.js"></script>
<script src="ship.js"></script>
<script src="wormhole.js"></script>
<script src="toolbar.js"></script>
<script>
    (function () {

        canvas = document.getElementById("canvas");
        canvas.width = document.body.clientWidth; //document.width is obsolete
        canvas.height = document.body.clientHeight; //document.height is obsolete
        let world = [];
        let s = new ship(50, 100, 10);

        document.onkeypress = key;
        document.onkeyup = keyUp;

        function key(e) {
            if (e.key === 'd') {
                s.rotate(1);
            }
            if (e.key === 'a') {
                s.rotate(-1);
            }

            if (e.key === 'w') {
                s.speedUp();
            }
        }

        function keyUp(e) {
            if (e.key === 'w') {
                s.speedEnd();
            }
            if (e.key === 'a' ||Â e.key === 'd') {
                s.rotateEnd()
            }
        }

        init(world)
        draw(world);

        function rand(min, max) {
            return Math.random() * (max - min + 1) + min;
        }

        function randfloat(min, max) {
            while (1) {
                v = Math.random();
                if (v > min && v < max)
                    return v
            }
        }

        function init(w) {

            for (let i = 0; i < 1000; i++) {
                addStar(w, canvas.width);
            }

            p = new planet(400, 400, 50, 150);
            w.push(p);
            s.addGravi(p)

            p2 = new planet(800, 400, 100, 200);
            w.push(p2);
            s.addGravi(p2);

            worm = new wormhole(600, 600, 50, 200);
            w.push(worm);
            s.addGravi(worm);


            w.push(s);

            t = new tb(50, 50, s);
            w.push(t)

        }

        function addStar(world, width) {
            z = randfloat(0.1, 0.2);
            y = rand(0.0, canvas.height);
            x = rand(0.0, width);
            world.push(new star(x, y, z));
        }

        function draw(w) {
            let ctx = canvas.getContext('2d');
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height); // clear canvas
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.restore();

            for (let i = 0; i < w.length; i++) {
                let obj = w[i];

                coll = obj.update();

                if (typeof coll === 'planet') {
                    
                }

                ctx.save();
                obj.draw(ctx);
                ctx.restore();

                if (obj.x > canvas.width && typeof star) {
                    w.splice(i, 1);
                    addStar(w, -10);
                }
            }

            window.requestAnimationFrame(() => {
                draw(w);
            });

        }
    })();

</script>

</html>